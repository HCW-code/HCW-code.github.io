---
layout: single
title: "[블록체인] 보안"
categories: blockchain
tag: [보안, 이중지불, 51%공격, 샤딩]
toc: true

---

### 블록체인의 보안적 특징

1. 데이터 무결성

   - 블록체인에서는 합의 알고리즘을 사용해 데이터의 무결성을 보장한다. 합의 알고리즘을 통해 블록에 입력된 데이터에 대해 분산된 각 노드가 모두 동일한 결과를 가질 수 있도록 한다.
   - 합의 알고리즘은 네트워크상에 존재하는 신뢰할 수 없는 노드들이 절차에 맞게 상호 검증하여 네트워크 전체의 무결성을 보장하는 알고리즘이다.

2. 거래 투명성

   - 퍼블릭 블록체인의 경우, 누구나 블록체인 네트워크에 접속해 트랜잭션 기록을 확인할 수 있다. 프라이빗 블록체인도 허가된 사용자라면 누구나 트랜잭션 기록을 볼 수 있다.
   - 거래 기록에 누구나 공개적으로 접근할 수 있기 때문에, 송금 과정을 투명하게 하기 위한 규제 비용을 절감할 수 있다.

3. 감시 가능성

   - 블록체인은 데이터 추가만 가능한 데이터베이스이다.
   - 이 과정에 사용되는 기술이 바로 해시 알고리즘으로 새로 생성되는 블록의 헤더에는 이전 헤더의 해시값이 포함되어 있기 때문에 연결된 모든 블록의 무결성 검증에 사용된다.
   - 그리고 블록에 담긴 트랜잭션을 나타내는 머클 트리의 루트 해시값이 블록 헤더에 함께 포함되어 있으며, 만약 트랜잭션에 변경이 일어나면 머클 해시값이 변경되므로, 블록체인에 대한 위변조 시도를 바로 발견할 수 있다.

   

### 이중지불 문제

이중 지불이란 디지털 현금 시스템 내에 동일한 하나의 자산이 두 명의 수신자에게 동시에 전송되는 문제를 의미한다.

#### 이중지불 문제를 막는 방법

- 중앙화된 접근법 : 데이비드 차움의 eCash
- 탈중앙화된 접근법

#### 비트코인 이중 지불

1. 51% 공격

   단일 주체나 조직이 50% 이상의 해시 레이트를 가지게 될 경우 이들은 원치 않는 트랜잭션을 배제하거나 트랜잭션 순서를 조작할 수 있게 된다. 비트코인에서 해당 공격이 발생할 가능성은 매우 낮지만 규모가 작은 다른 네트워크에서는 발생할 수 있다.

2. 레이스 공격(Race Attacks)

   동일한 자금을 사용하는 두 개의 충돌하는 트랜잭션이 연속으로 전송되지만, 하나의 트랜잭션만 승인되는 것이다. 레이스 공격은 수신자가 체인에 올라가지 않은 트랜잭션을 결제로 수용할 때 가능하다.

3. 핀니 공격(Finney Attacks)

   공격자는 네트워크에 즉각적으로 트랜잭션을 전송하지 않고, 코인을 자신의 다른 지갑으로 전송하는 트랜잭션을 미리 생성해두고, 블록을 미리 채굴해두어 해당 블록에 기록한다. 동일 코인을 다른 트랜잭션에서 사용하는 대신, 이전에 채굴한 블록만을 전송하며, 결제는 무효화된다. 핀니 공격은 특정한 순서에 따라 사건이 발생해야 하며, 수신자는 체인에 올라가지 않은 트랜잭션을 수용해야 발생할 수 있다.

이중 지불은 디지털 현금 시스템에서 경제적 이익을 얻기 위해 동일한 자금을 여러번 사용하는 것이다. 이중 지불 문제는 적절한 해결책이 없었기 때문에, 디지털 현금 시스테의 발전에 큰 걸림돌이었다. 그러나 은닉 서명이 중앙화된 경제 체계에 해결책을 제시하였다. 또한 작업 증명 메커니즘과 블록체인 기술의 개발로 탈중앙화된 자산의 형태인 비트코인이 탄생했으며, 비트코인은 수천 개의 암호화폐 프로젝트에 영감을 주었다.



### 리플레이 공격

리플레이 공격이란 공격자가 보안 네트워크 통신을 가로채고, 해당 통신의 수신자에게 공격자가 원하는 일을 수행하도록 하기 위해 통신을 지연시키거나 재전송하는 방식이다.

리플레이 공격은 해커가 네트워크에서 메시지를 가로챈 후 메시지를 복호화하기 위한 별도의 과정이 필요하지 않으며, 메시지를 포함한 통신 전체를 다시 전송하는 것으로도 공격을 성공할 수 있다.
<center>
<img src="../../images/2022-10-04-blockchain_32th/image-20221004141158100.png" alt="image-20221004141158100" style="zoom: 25%;" />
</center>
#### 암호화폐에서 리플레이 공격이 위함한 이유

하드포크가 진행되면, 원장 데이터는 하드 포크 이전 버전과 이후 버전으로 나누어지게 된다. 하드포크가 진행되어 체인이 A와 B로 나누어졌다고 가정하면 하드 포크 이후 생겨난 B체인에서 처리한 트랜잭션은 이론적으로 A체인에서도 유효하게 사용할 수 있다.

따라서 A와 B에 모두 계정이 있는 사용자는 B에서 트랜잭션을 발생시켰을 때, A체인에서 누군가가 해당 트랜잭션을 탈취해 브로드캐스팅하면 A체인에서도 해당 트랜잭션이 처리된다.



#### 리플레이 공격 대안

1. 세션 식별자 추가

   통신 당사자간 일회용 토큰을 해싱한 값을 공유하여 리플레이 어택을 피한다.

   1. 앨리스가 밥에게 일화용 토큰을 보낸다.
   2. 밥은 토큰을 암호화하여 앨리스에게 보낸다.
   3. 앨리스는 밥과 동일한 방식으로 토큰을 암호화하고, 그 값이 밥으로부터 받은 값과 같은 경우 통신을 진행한다.
   4. 공격자가 이 암호화된 값을 가로채고 다른 통신에서 사용하려고 해도, 앨리스가 밥에게 다른 일회용 토큰을 보내면 다른 암호화된 값이 나올것이기 때문에 공격자가 가로챈 값은 사용 불가하다.

2. 일회용 비밀번호

   아주 짧은 세션 시간을 가진 비밀번호를 두 통신 당사자가 공유하여 공격자가 가로채 재사용하지 못하도록 한다.

3. 타임 스탬프

   앨리스가 네트워크에 시간을 MAC와 함께 브로드캐스트한다. 밥은 앨리스에게 통신을 요청할 때 자신의 통신 메시지에 앨리스가 브로드캐스트한 시간을 기준으로 예상 시간을 포함해 인증을 진행한다. 앨리스는 타임 스탬프가 예상 시간 범위 내에 있는 메시지만 수락한다.



### 이클립스 공격

공격자가 네트워크상의 노드를 방해하기 위한 공격으로 정교한 공격을 준비하기 위해 네트워크에 혼란을 야기시킬 때 주로 사용한다.

이클립스 공격은 전체 네트워크를 공격하기보다는 특정 노드를 격리해 정직한 다른 노드로부터 정보를 수신받지 못하게 여러 악의적인 공격자 노드가 네트워크를 독점한다. 이 공격 노드들은 가짜 트랜잭션이 담긴 블록을 격리한 노드들에 브로드 캐스트하여 이중 지불 공격을 가능하여지도록 만든다.

#### 이클립스 동작 방식

공격자는 공격 대상의 이웃 노드들을 자신의 노드로 구성하여, 공격 대상 노드가 가짜 트랜잭션이 담긴 블록을 받도록 한다. 이를 통해 다음과 같은 공격 효과가 발생한다.

- 엔지니어링 블록 레이스(Engineering Block Races)

  블록 레이스는 채굴 노드들이 가장 먼저 유효한 논스 값을 찾아 블록을 생성하는 경쟁을 의미한다. 이클립스 공격에서는 이클립스 공격 대상 노드와 공격자의 노드가 동시에 블록을 생성한 경우, 공격 대상 노드가 생성한 블록을 숨김으로써 해당 블록은 고아 블록이 되고, 자신의 블록이 네트워크에 올라갈 수 있도록 한다.

- 채굴 파워 분할(Splitting Mining Power)

  공격자가 51% 공격하기 위해 네트워크의 전체 채굴 파워를 쪼갤 수 있다. 이러한 방식으로 공격자의 채굴 파워가 네트워크의 쪼개진 파워보다 커지게 되면 쉽게 51% 공격을 개시할 수 있다.

- N - 컨펌 이중 지불(N-Confirmation Double Spending)

  이클립스 공격자에 의해 여러 채굴 노드들이 공격 대상이 되어 격리된 경우, 공격자는 자신의 트랜잭션을 이클립스 공격대상인 채굴 노드에게 제공하여 블록체인에 추가하도록 한다. 이 노드들은 이후에도 블록을 계속 생성하면서 공격자의 트랜잭션이 든 블록이 컨펌되도록 한다.

  이클립스 공격 대상이 된 가게 주인은 트랜잭션이 들어있는 블록이 컨펌되는 것을 보고 물건을 제공한다. 이후, 공격자가 격리된 노드들이 만든 블록체인을 전체 네트워크에 공유하면, 해당 블록체인의 노드들은 고아 블록이 되면서 트랜잭션 자체가 취소되게 된다.

#### 이클립스 공격 대처 방법

- 무작위 노드 선택

  노드가 피어를 선택할 때 무작위가 아닌 경우, 공격자가 자신 주변의 노드를 공격 대상으로 선택할 수 있게 된다. 따라서 노드가 피어를 랜덤으로 선택하게 하여 공격자가 공격 대상 노드를 정하기 어렵게 만들 수 있다.

- 정보 저장

  노드가 다른 노드에 대한 정보를 기억하도록 하면, 해당 노드가 네트워크를 떠났다가 재접속 했을 때 이전에 연결했던 정직한 노드와 연결하여 정직한 피어 관계를 지속할 수 있다.

- 연결 수 늘리기

  하나의 노드에 연결된 피어의 개수를 늘리면, 노드가 정직한 노드에게 연결될 가능성이 커진다.

### 인적 문제로 발생할 수 있는 보안적 이슈

- 크립토재킹
- 더스팅 공격
- 시빌 공격

### 구현된 블록체인에서 생길 수 있는 보안적 이슈

- DAO 사건
- 패리티 멀티시그 지갑 동결 사건



### CAP 이론과 PACELC 이론

