---
layout: single
title: "[블록체인] 다양한 채굴 방법"
categories: blockchain
tag: [채굴, mining]
toc: true

---

## 작업 증명(PoW)

작업 증명(PoW)은 Proof of Work의 약자이며 작업의 증명을 뜻하며, 유효한 블록을 만드는 데 충분한 계산 자원을 소모했다는 증명이다.  
이때, 메인체인을 선택하는 데 있어 가장 긴 체인을 채택하는 알고리즘은 고스트 프로토콜을 사용하여 블록이 결정된다.

블록이 결정되는 방법 - **고스트 프로토콜(Ghost Protocol)**

고스트 프로토콜은 어느 체인이 가장 긴 것인지 계산할 때 고아블록도 포함함으로써 네트워크 보안 손실 문제를 해결한다.  
다시 말해 어느 블록이 가장 큰 전체 작업증명을 가졌는지 계산하면서 그 블록의 부모 블록과 조상뿐만 아니라, 그 블록의 고아 자신까지도 더한다는 것이다.

PoW의 대표적인 코인에는 비트코인, 비트코인 캐시 등이 있다.  
작업 증명 방식의 합의 알고리즘은 어떤 트랜잭션이 발생했을 경우 해당 트랜잭션이 유효한 트랜잭션인지에 대해 합의해 해결한다는 특징과 새로운 블록이 진짜인지, 가짜인지에 대한 검증을 수행한다는 특징을 갖고 있다.

### 논스를 찾는 방법

비트코인에서 작업증명은 반복적인 과정을 통해 무작위로 **특정한 조건보다 낮은 값(Nonce)**을 찾아내어 그에 대한 대가로 비트코인을 받게 된다.  
이때 무작위의 논스값을 찾아내기 위해 비트코인에서는 SHA-256 방식을 사용하는데, 이 과정에서 컴퓨터의 계산 능력이 필요하며, 서로 다른 컴퓨터가 같은 문제를 풀기 위해 경쟁한다.

경쟁을 통해 결국 하나의 블록이 생성되므로, 블록 생성에 성공한 블록 외의 다른 컴퓨터가 사용한 전력은 고스란히 낭비된다. 즉, 자신의 해시파워가 높을수록 원하는 값을 얻기가 쉬워지지만, 그러려면 엄청난 금액의 채굴기와 전기료를 감당해야 한다.

<img src="../../images/2022-09-07-blockchain_20th/image-20220907185149921.png" alt="image-20220907185149921" style="zoom:50%;" />

위의 식에서 논스를 찾는 방법은 무차별 대입 방법 밖에 없다. 특정 개수의 0이 있는 패턴을 찾은 채굴자는 블록을 즉시 브로드캐스팅하고, 다른 채굴자들은 블록을 승인하게 된다.

### 작업증명(PoW)의 장점

가장 큰 장점은 높은 보안성이다. 블록체인의 취약점으로 알려진 51% 공격을 손쉽게 방어할 수 있다.  
51% 공격이란 악의적인 공격자가 그들의 행위를 성공시키기 위해서 51%이상의 컴퓨팅 파워를 확보해야 한다는 것이지만, 현실적으로 작업증명에서 51% 이상을 획득하는 것은 천문학적 비용이 발생하기 때문에 발생하기 매우 어렵다.

### 작업증명(PoW)의 단점

채굴 난이도가 높아지면서 개인 채굴자는 채굴할 수 없는 수준까지 도달하였다. 또한 연산에 필요한 고사양 장비가 필요하게 되고, 과도한 전력 소모로 인해 에너지 낭비가 커졌다. 비트코인 채굴에 소모되는 전력량이 연간 약 48테라 와트시로 추정되었다. 이러한 구조는 기업형 채굴자들이 등장하게 되고, 이와 더불어 그들의 단합으로 채굴권이 집중되는 문제가 발생되고, 결국 이런 이유로 인해 탈중앙으로부터 멀어지게 될 수도 있다.

### 비트코인 채굴 알고리즘

1. 비트코인 네트워크로부터 이전 블록의 헤더를 얻는다.
2. 네트워크상에서의 트랜잭션 브로드캐스트 세트를 제안할 블록에 넣어서 합친다.
3. 이전 블록 헤더 값의 Double 해시를 계산하고 논스와 새롭게 제안된 블록을 SHA256 알고리즘을 사용해 결합한다.
4. 결과 해시 값이 현재의 타겟 난이도보다 낮은지 확인하고, 낮으면 PoW를 푼것이다. PoW 성공시 발견된 블록은 네트워크에 브로드캐스트되고 보상받는다.
5. 결과 해시값이 현재의 타겟 난이도보다 높지 않다면, 위 과정을 반복하며 논스값을 증가시킨다.

난이도 레벨은 비트코인 CLI를 통해 확인할 수 있다.
<center>
<img src="../../images/2022-09-08-blockchain_20th/image-20220907201905464.png" alt="image-20220907201905464" style="zoom: 50%;" />
</center>
이 숫자는 비트코인 네트워크상의 난이도를 나타낸다.  
이 숫자는 매 2016블록마다(약 2주) 평균적으로 10분마다 새로운 블록이 발생하도록 조정하기 위해 변경된다.
<center>
<img src="../../images/2022-09-08-blockchain_20th/image-20220907203937336.png" alt="image-20220907203937336" style="zoom: 33%;" />
</center>
PoW 대표 코인 - 비트코인, 이더리움

## 지분 증명(PoS)

지분 증명은 Proof of Stake의 약자이며, 해당 암호화폐를 보유하고 있는 지분율에 비례하여 의사결정 권한을 주는 합의 알고리즘이다.  
PoS는 컴퓨팅 파워 낭비가 심한 PoW와는 달리 자신의 지분(Stake), 즉 스테이킹(Staking)한 자산을 통해 블록을 생성하게 돈다.

주주총회에서 주식 지분율에 비례하여 의사결정 권한을 가지는 것과 유사하여 지분의 크기만큼 다음 블록의 검증 노드로 선택될 확률이 결정되며, 블록 형성 권한과 거래 수수료를 보상으로 받게 된다.

PoW처럼 무의미하게 논스값을 찾거나 할 필요가 없어서 경제적이고 친환경적이며, 전체적으로 작업 증명(PoW)의 단점을 보완하는 합의 알고리즘이다.

스테이킹(Staking)한 자산을 통해 블록을 생성하면 되기 때문에 비싼 하드웨어가 필요하지 않고 작업증명(PoW) 방식에 비해 전기를 많이 소모하지 않으며, 작업증명 방식에 비해 다른 코인으로 이탈 가능성이 작다. 그 이유는 오랜 기간 코인을 보유해야 하는 조건 때문이다. 이와 더불어 검증시간이 짧은 특징이 있다.

### 지분 증명(PoS)의 장점

- 환경친화적 시스템

  작업증명방식과 대조적으로 에너지 소모가 큰 프로세스가 없다

- 인센티브에 대한 강한 동조 및 지지

  작업 증명 방식의 문제점 중 하나가 채굴자들과 암호화폐 보유자들의 이해관계가 일치하지 않을 수도 있다는 점과 해시율을 임대할 수 있다는 점이다.  
  지분 증명 방식은 이와 다르게 합의 대리인을 직접적으로 암호화폐에 투자하게 만들고 그에 따라 투자자와 합의 대리인의 이해관계가 같아지게 되는 특징이 있다.

  해시율 : 연산 처리 능력을 측정하는 단위로 해시 속도를 의미한다.

- 채굴 풀의 중앙집중화를 해결

  현재 작업 증명은 소수의 채굴 풀에 해시가 집중되는 방식이라 지분 증명이 보다 더 탈중앙화에 적합한 대안이다.

### 지분 증명(PoS)의 단점

- 불안전한 해결책

  지분증명(PoS) 방식 시스템은 체인 선택에 대한 해결책만을 제시했다. 그 외 나머지 문제점들에 대한 해답을 제시하진 못한다.

- 불공평한 경제 모델

  이 시스템은 암호화폐 보유량에 비례하여 신규 자금을 배당한다. 그 뜻은 소수의 사람에게 자금이 집중될 수 있다는 것을 의미한다. 이러한 점을 보고 보상 시스템이 쓸모 없고 인센티브를 전혀 제공하지 못한다고 비칠 수 있다.

- Nothing at Stake Problem

  지분 증명 방식의 최대 문제점이다.  
  지분 증명 방식은 모든 노드가 제한 없이 여러 블록에 자신의 지분을 증명할 수 있기 때문에 만약 하나의 거래에서 서로 다른 거래내용이 발생한 경우 많은 지분을 가진 노드가 공격을 목적으로 두 개의 블록에 모두 증명해놓고, 거짓인 체인도 참인 것처럼 길게 체인을 형성시킬 수 있다.

  블록에 새로 참여한 검증자(Validator)는 어느 것이 정당한 블록체인인지 알 방법이 없다.  
  그래서 새로 많은 지분을 사들여 검증에 참여하는 노드가 거짓인 블록체인제 증명(합의)해버릴 경우 제대로 된 거래를 한 사람은 모두 공격에 당하는 꼴이 된다.

### 이더리움이 PoW에서 PoS로 전환하려는 이유

이더리움 개발팀은 1%를 먼저 PoS로 전환하고 점차 그 비중을 늘리는 방식을 선택했다.  
그 과정에서 난이도 폭탄이 터지도록 설정해서 PoW로 얻을 수 있는 양이 급격히 줄도록 설계돼있어서 PoW에서 PoS로의 전환이 자연스럽게 이행되게끔 계획되어 있다.  
또한 캐스퍼라는 이름으로 PoW PoS 전환 프로젝트를 진행하는데 이 캐스퍼 프로젝트가 비트코인처럼 업그레이드하고 나면 그걸 거부하고 기존 코인을 기존 코인을 채굴해서 쪼개지고 하는 걸 막을 수 있다.  
51% 이상이 동의하지 않는데 생성된 블록들은 캐스퍼에 의해 소멸해버리도록 해버리는 것이다. 그래서 이더리움은 이제 쪼개질 위험은 없다는 판단되는 것이다.

- 캐스퍼 프로젝트

  이더리움의 합의 알고리즘인 PoW를 PoS로 전환하는 것을 목표로 하는 프로젝트이다.  
  캐스퍼 네트워크는 캐스퍼 CBC 사양으로 구축된 최초의 라이브 베팅 증거 블록체인이다. Casper는 오늘날 기업과 개발자의 블록체인 기술 채택을 가속화하고 미래의 사용자 요구를 충족하도록 진화하도록 설계되었다.

- 캐스퍼가 기존의 PoS와 다른점

  캐스퍼 PoS 작동 방식 중 하나가 악한 행위를 하는 검증인들을 처벌하는 것이다.  
  검증인들은 블록을 검증 전에 자신의 이더 지분을 맡겨야 한다.(테스터넷 최소 1500이더)

  검증인들은 체인의 연결 될것이라고 믿는 블록에 원하는 만큼 베팅을 한다.  
  만약 자신이 베팅한 블록이 체인의 연결이 되면 검증인들은 베팅한 만큼 보상을 받게 된다.  
  그러나 검증인들이 Nothing at Stake 문제와 같이 체인을 어지럽히는 악한 행위를 하면 처벌받게 된다. 여기서 처벌은 검증인들이 자신이 걸어놓았던 지분을 몰수당하는 걸 의미한다.
<center>
  <img src="../../images/2022-09-08-blockchain_20th/image-20220908002240057.png" alt="image-20220908002240057" style="zoom: 33%;" />
</center>
  
  
  PoS 대표 모델 - 네오, 제트캐시, 퀀텀, 에이다, 피어코인, 코스모스

## 위임지분증명(DPoS)

위임지분증명(DPoS, Delegated Proof of Stake)이란, 암호화폐 소유자들이 각자의 지분율에 비례하여 투표권을 행사하여 자신의 대표자를 선정하고, 선정된 대표자들끼리 합의하여 의사결정을 내리는 합의 알고리즘이다.  
지분 증명이 자산을 가진 사람들이 전부 참여할 수 있는 방식이라면, 위임지분증명은 특정 인원에게만 지분 증명을 할 수 있도록 권한을 위임하는 것이다. 즉, 특정인 몇명만이 블록을 생성하여 증명할 수 있는데 이는 국민의 대표로 의원을 뽑아 의회를 구성하는 대의 민주주의 제도와 유사하다.

지분증명에 대한 비판으로 위임지분증명(DPoS) 방식이 등장하게 되었으며, 암호화폐 소유자들이 각자의 지분율에 비례하여 투표권을 행사하여 자신의 대표자를 선정하고 이 대표자들끼리 합의하여 의사결정을 내리는 방식으로 진행된다.  
위임지분증명 방식은 지분증명 방식과 달리 누구에게나 대표자가 될 기회가 주어지지 않는다.  
대표자가 되기 위해선 투표를 거쳐야 하며, 이때 명칭이 바뀌는데 투표를 통해 선출된 사람을 대표자라고 한다.  
선출된 대표자들은 블록을 생성하고, 블록을 확정하기 위해선 2/3 이상의 승인이 필요하다. 대표자의 지위는 일정 시간 이내에 블록 셋업에 참여해야 유지가 된다.
<center>
<img src="../../images/2022-09-09-blockchain_20th/image-20220909214026147.png" alt="image-20220909214026147" style="zoom:50%;" />
</center>
### 위임지분증명(DPoS)의 장점

- 소규모 참여자도 이득을 볼 수 있다.
- 거래속도(TPS)가 빠르다.

위임지분증은 지분증명과 달리 같은 시간에 훨씬 더 많은 거래를 처리할 수 있다는 점과 수수료가 없다는 장점이 있다.

### 위임지분증명(DPoS)의 단점

- 네트워크 보안

  블록체인은 탈중앙화 되어 강력한 보안성을 지닌다는 특징을 갖고 있는데, 위임지분증명 방식의 경우에는 지분을 위임받은 대표자들의 수가 제한되어 있다보니 탈중앙화가 되지 않아 보안에 취약할 수 있다.  
  또한 탈중앙화된 네트워크가 외부 공격에 강한 이유가 익명성 때문인데 위임지분증명의 경우에는 대표자를 선출하고자 한다면 대표자에 대한 정보를 밝혀야 한다는 딜레마를 갖고 있다.

- 대표자의 수

  네트워크가 커짐에도 불구하고 대표자의 수가 일정하다면 상대적인 중앙화가 이루어질 수 있기 때문에 암호화폐를 보유하고 있는 사람들의 수가 많아질수록, 네트워크가 커질수록 대표자의 수는 늘어나야 한다.  
  하지만 이렇게 대표자의 수가 증가하면 반대로 위임지분증명이 가지고 있는 속도의 장점이 줄어들게 되는 문제가 발생한다.

DPoS 대표 모델 - 이오스, 스팀, 비트셰어, 엘프, 테조스



## 거버넌스 블록체인의 채굴 - Klaytn

거버넌스(Governance) 블록체인

블록체인을 통해 기존 네트워크와는 달리 누군가의 개입없이 우리의 이익을 대변한 네트워크 구조를 만들어 낼 수 있게 되며, 현실과 마찬가지로 하나의 세계라고 볼 수 있다. 세계를 유지하기 위해서는 구성원들과의 이해관계 조정이 필요한데, 우리들의 이익을 대변할 수 있는 네트워크 구조를 만들기 위해서 네트워크 구성원간 의사 통합이 중요해지고 복잡해질 수 밖에 없다.

이때 필요한 것이 바로 거버넌스이며, 블록체인 안에서의 거버넌스를 블록체인 거버넌스라고 부른다.

기본적으로 거버넌스는 공동의 관심사에 대한 네트워크를 구축하여 문제를 해결하는 새로운 국정운영의 방식을 의미하는데, 블록체인 안에서의 거버넌스도 이와 다르지 않다.  
블록체인에서의 거버넌스란 네트워크 세계를 유지하기 위해서 해당 프로젝트 코인을 보유하고 있는 투자자가 투표로 안건을 채택하는 것을 말한다.

블록체인 거버넌스는 투표로써 가장 일반적으로 사용이 된다.  
비트코인, 이더리움의 BIP, EIP 및 개발자 그리고 여러 커뮤니티를 통해 네트워크의 방향성을 정하고 있고, 비트코인 이더리움 이외에도 다양한 코인들이 조금씩 다른 방식으로 거버넌스를 구성하고 있으며, 클레이튼 역시 거버넌스의 형태를 띄고 있다.

클레이튼이란 카카오의 자회사인 그라운드X가 개발한 디앱(dApp)을 위한 블록체인 플랫폼이다.

### 클레이튼의 합의 메커니즘

Klaytn에는 컨센서스 노드(CN), 프록시 노드(PN) 및 엔드포인트 노드(EN, (구)레인저 노드(Ranger Node))라는 세가지 유형의 노드가 있다.  
컨센서스 노드는 CCO(Core Cell Operators)에 의해 관리되며 블록 생성을 담당한다.
<center>
<img src="../../images/2022-09-09-blockchain_20th/image-20220909232751168.png" alt="image-20220909232751168" style="zoom: 33%;" />
</center>
#### IBFT(Istanbul Byzantine Fault Tolerance)

Klaytn은 Istanbul BFT라는 합의 메커니즘을 사용하고 있다. IBFT는 블록체인 네트워크의 특성을 반영하여 변형된 버전의 PBFT이다. IBFT는 즉각적인 최종성을 보장하는 권한 증명(PoA) 블록체인 합의 알고리즘이다. 기본적으로 PBFT의 형식을 따라가며 블록을 모아서 전송한다는 개념이 추가되었다.

PBFT의 유효성 검사기 집합은 정적이지만 IBFT는 동적 유효성 검사기 집합이 있다는 점에서 PBFT와 다르다.  
이를 통해 IBFT 합의 메커니즘 기반 블록체인은 PBFT 합의 메커니즘 기반 체인보다 빠르게 트랜잭션을 확인할 수 있다.

**작동방식**

- 시작하려면 노드 그룹이 선택되어 유효성 검사기 풀을 구성한다. 이 노드는 제안된 블록이 체인에 추가하기에 적합한지 여부를 결정하는 역할을 한다.
- 이 검증자 노드 중 하나가 제안자로 임의로 선택된다.
- 검증자 풀에서 메시지를 받은 이 단일 제안자는 체인에 무엇을 추가할지 결정한다. 이것은 다른 검증자에게 제안된 블록으로 제시된다.
- 대다수의 검증인이 블록이 유효하다고 간주하는 경우에만 원장에 추가된다.
- 각 합의 라운드가 끝나면 검증자가 새로운 제안자를 선택하고 프로세스가 반복된다.

## 채굴 알고르즘 종류

- SHA256
- X11
- X13
- X16R
- Grostl
- NeoScrypt
- Ethash
