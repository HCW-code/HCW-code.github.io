---
layout: single
title: "[블록체인] 이더리움 EVM과 Solidity"
categories: blockchain
tag: [abi, byte code, remix, remixd]
toc: true

---

### 솔리디티 코드 컴파일

```solidity
solc --optimize --bin simpleStorage.sol
```

solc --bin {컴파일할 sol 파일 이름} 은 솔리디티 파일을 이진 형식으로 컴파일하는 명령어이다.

--optimize는 컴파일 전, 작성한 솔리디티 코드가 약 200회 실행된다고 가정했을 때를 기준으로 컨트랙틀를 최적화한다.

명령어를 실행하고 나면 16진수 이진 코드가 출력된다.

### ABI

ABI(Application Binary Interface)는 스마트 컨트랙트 코드에 대한 설명이 담긴 JSON 형식의 인터페이스이다.  
이더리움 네트워크에 있는 각 노드는 지갑을 통해 상호작용하는데 이때 JSON-RPC 형식의 데이터로 상호작용을 한다. 이 상호 작용을 위한 데이터가 ABI이다.

```solidity
solc --abi simpleStorage.sol
```

### 배포

1. bytecode와 abi를 사용하여 컨트랙트 객체를 생성한다. 이 객체는 블록체인에 컨트랙트를 배포할 때 사용된다.
2. 배포 트랜잭션을 생성한다. 트랜잭션을 생성할 때, 계정, gas limit, 컨트랙트 객체 등이 포함되어야 한다.
3. 트랜잭션을 네트워크에 올린다.
4. 이후 채굴 노드가 이 배포 트랜잭션을 포함한 블록을 채굴하고 브로드캐스팅하게 되면, 우리가 작성한 스마트 컨트랙트의 CA(컨트랙트 계정)가 생성된다.

배포는 하나의 방법이 아닌 배경이나 언어에 따라 여러 방법으로 가능하기 때문에 더 자세한 사항은 본인의 환경 설정과 언어, 블록체인 네트워크를 확인해 보아야 한다.

만약 Remix를 사용한다면 컴파일 버튼을 누르고 배포 칸으로 들어와 설정(Account, gas, value) 후 버튼 클릭만으로 배포는 자동으로 이루어져 컨트랙트 주소가 생성된다.

이렇게 생성된 주소가 바로 스마트 컨트랙트 계정 주소 값이 되며, 이 주소 값으로 스마트 컨트랙트를 활용할 수 있다.

**트랜잭션 해시와 스마트 컨트랙트의 주소값은 전혀 다른값이다**.

### 접근 및 사용

스마트 컨트랙트 주소를 이용하여 정보를 활용할 수 있다.

트랜잭션을 생성할 때 스마트 컨트랙트 주소를 사용하게 되면, 스마트 컨트랙트가 가지고 있는 메서드를 사용할 수 있다. 이더리움 블록체인에 있는 상태를 변경하거나 조회할 수 있다.

송금이나 스마트 컨트랙트 등, 상태를 변경하는 경우엔 함수를 실행하겠다는 메시지를 담은 트랜잭션을 보내야 한다. 블록체인에 기록을 하는 것이기 때문이다.

반면, 블록체인으로부터 스마트 컨트랙트의 변수값 등을 단순히 조회만 하는 경우 블록체인에 기록하지 않기 때문에 별도로 비용이 들지 않는다. 따라서 일반적인 트랜잭션과는 다르게 자신의 노드에 동기화된 블록 내 데이터를 읽어주는 트랜잭션 call 을 한다. 트랜잭션 call은 데이터를 읽기만 하므로 비용이 들지 않는다.

### Remix

VSCode를 비롯한 Atom, IntelliJ 등의 우리가 일반적으로 사용하는 데스크톱 IDE에서는 자체적으로 솔리디티 코드를 디버깅하거나 컴파일하는 기능이 없다. 따라서 솔리디티 코드를 컴파일, 배포, 테스트, 디버깅해주는 Truffle과 로컬 환경에 블록체인 테스트넷을 사용할 수 있게 해주는 Ganache를 함께 사용해야 한다.

웹 기반 IDE인 Remix는 솔리디티 개발을 위한 IDE이다. 자체적으로 솔리디티 개발을 위한 컴파일, 배포, 테스트, 디버깅 기능을 내장하고 있기 때문에 별도의 프레임워크나 라이브러리를 설치하지 않아도 쉽게 솔리디티 코드 작성부터 테스트넷 배포까지 할 수 있다.

### Remixd

Remixd는 로컬 컴퓨터에 저장된 소스 코드 파일 또는 폴더를 Remix IDE와 로컬 호스트에서 웹소켓 통신으로 연결한다. Remix IDE에서 연결된 파일 또는 폴더가 변경될 경우, 로컬 컴퓨터에도 자동으로 저장된다. 따라서 Remixd를 사용해 편리하게 코드를 백업할 수 있다.

1. Visual Studio Code를 열고 새로운 폴더를 만든다.

2. 터미널에서 다음의 명령어를 실행하여 package.json 파일 생성

   ```shell
   npm init
   ```

3. 터미널에 remixd를 설치

   ```shell
   npm install -g @remix-project/remixd
   ```

4. 폴더 내에 sol 파일을 만든다.

5. 터미널에 다음과 같은 명령어를 입력한다. 이 명령어는 해당 디렉토리를 Remix IDE와 웹 소켓으로 연결한다.

   ```shell
   remixd -s <remixd_practice 폴더의 절대경로> --remix-ide https://remix.ethereum.org
   ```

   