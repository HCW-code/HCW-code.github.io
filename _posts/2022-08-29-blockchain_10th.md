---
layout: single
title: "[블록체인] 암호화 기술"
categories: blockchain
tag: [blockchain, 암호화, 대칭 키, 비대칭 키, 디지털 서명, 해시 함수]
toc: true
---

## 암호화 기술

### 암호 기술의 기본

암호학이란 안전한 의사소통을 위한 암호화/복호화 과학이다. 단순하게 말해 암호란 사람이 읽을 수 있는 평문을, 타인이 이해할 수 없도록 암호문으로 만들어 전송하고, 그것을 다시 사람이 읽을 수 있는 평문으로 복구하는 것이다.
<center>
<img src="../../images/2022-08-29-blockchain_10th/image-20220829142330965.png" alt="image-20220829142330965" style="zoom: 33%;" />
</center>
### 대칭 키 암호 방식과 비대칭 키 암호방식

블록체인에서의 암호는 대표적으로 '보안'을 위해서 사용되고, 기밀성, 무결성, 인증, 부인 방지를 위해서 사용한다.

- 기밀성 : 타인이 볼 수 없도록 암호화하여 숨김
- 무결성 : 메시지가 수정되지 않았는지 검증해야 함
- 인증 / 부인 방지 : 본인이라는 것을 확인함

위 기능들은 대칭 키, 비대칭 키 암호방식과 해시 함수를 사용하여 구현된다.

#### 대칭 키

암호화를 할 때의 키와 복호화를 할 때의 키가 같은 것을 대칭 키라고 한다. 대칭 암호화 방식은 여러 사용자 사이에 공유된 단 하나의 키를 기반으로 한다.

- 블록 암호 방식 : 데이터를 미리 정해둔 사이즈로 잘라 청크(chunck) 단위로 그룹화하고, 각 블록을 개인 키로 암호화한다.
- 스트림 암호 방식 : 원본 데이터의 길이와 같은 키로 키 스트림(Key Stream)을 생성하고, 원본 데이터와 키 스트림을 XOR 연산하여 암호화한다. 나중에 복호화 할 때도 암호화된 값과 키 스트림을 XOR 연산을 하면 원본 데이터가 나오게 된다.
<center>
<img src="../../images/2022-08-29-blockchain_10th/image-20220829142922673.png" alt="image-20220829142922673" style="zoom: 33%;" />
</center>
<br>

대칭 키를 사용하게 된다면 전송 과정에서 악의적인 해커가 암호화한 데이터와 함께 키를 탈취할 수 있는 키 배송 위험 문제가 발생한다. 데이터 암호화 및 복호화에 사용하는 키를 관리하는 것이 어렵다는 것이다.

#### 비대칭 키

비대칭 키 암호 방식은 대칭 키 암호 방식과 다르게 단일 키가 아닌 공개 키와 개인 키 2가지를 사용한다.

##### 공개 키 암호 방식

일반적으로 공개 키는 전송자가 정보를 암호화하는데 사용하며, 개인 키는 수신자가 데이터를 복호화 하는 데 사용한다.
<center>
<img src="../../images/2022-08-29-blockchain_10th/image-20220829143502853.png" alt="image-20220829143502853" style="zoom: 33%;" />
</center>
공개 키로 암호화한 데이터는 개인 키로 복호화 할 수 있어야 하기 때문에 두 키는 알고리즘에 의해 수학적으로 연결되어 있다.

공개 키 암호 방식(비대칭 키 암호 방식)은 기존의 대칭 키 암호 방식이 가졌던 키 배송 위험 문제를 해결하여 컴퓨터 보안을 강화하며, 데이터의 무결성을 확인하는 데 사용할 수도 있다.

그러나 암호화 및 복호화의 수학적 계산이 매우 복잡하기 때문에 대량의 데이터를 처리할 경우 오버헤드가 발생하여 속도가 느려질 수 있다. 또한 대칭 키 암호 방식과 마찬가지로, 개인 키가 안전하지 않은 공간에 노출되는 경우, 대응하는 공개 키로 암호화된 모든 데이터의 보안이 위협받게 된다.

##### 개인 키 암호 방식

개인 키 암호 방식은 개인 키로 암호화를 하고 공개 키로 복호화를 한다. 개인 키의 소유자가 개인 키로 데이터를 암호화를 한 뒤에 공개 키와 함께 전달하는 방식이다.

이 방식은 데이터 보호보다, 신원 확인(보장)을 위해 사용된다.

공개 키와 개인 키는 한 쌍으로 한쪽 키로 암호화를 했다면 다른 한쪽 키로 복호화를 할 수 있다는 특성을 활용하여, 공개 키와 한 쌍인 개인 키로 암호화했다는 것을 증명한다. 블록체인에서 이 방식은 전자 서명에 사용된다.

비대칭 키 암호 방식은 말 그대로 데이터를 암호화하기 위해 만들어진 방식이다. 그렇기 때문에 해당 내용에 관해 검색을 하다보면 공개 키 암호 방식을 비대칭 키 암호 방식의 디폴트로 가정하고 혼용하여 부르는 경우도 있다. 개인 키 암호 방식(공개 키 서명 방식)은 데이터를 복호화하여 대조하기 위한 방식이기 때문에 특이한 케이스이다. 단어가 헷갈릴 수 있으니 주의

#### 대칭 키 암호와 비대칭 키 암호의 혼용

대칭키 암호방식은 네트워크나 CPU의 오버헤드가 적고 빠르게 작동한다. 비대칭 키 암호 방식은 대칭 키 암호 방식의 단점을 보완했으나 많은 연산을 요구하기 때문에 속도가 느리다. 그렇기에 용량이 큰 파일을 암호문으로 처리하는 데에 한계가 있다.

그렇기 때문에 대부분의 웹 프로토콜은 대칭키 암호화 방식과 공개키 암호화 방식을 혼합하는 "디지털 봉투(전자 봉투)" 기술을 사용한다.

디지털 봉투란 대칭키를 사용해 데이터를 암호화한 후, 암호화에 사용한 대칭키를 비대칭키로 암호화하여 안전하게 전송하는 것을 의미한다.

대표적으로는 TLS(Transport Layer Security)의 암호화 프로토콜로, TLS에서는 공개 키 암호 방식을 사용해 대칭 키 암호 방식에 사용할 키를 공유한다.

#### 공개 키 암호 방식과 대칭 키 암호 방식의 비교

1. 키의 길이

   대칭 키 암호화 알고리즘은 키의 길이가 임의로 지정되며, 보안 수준에 따라 128비트나 256 비트로 설정된다.  
   반면 공개 키 암호화 알고리즘은 공개 키와 개인 키가 수학적으로 한 쌍을 이루어야 하기 때문에 수학적 패턴을 가지고 있다.  
   어떠한 패턴을 가졌다는 것은 곧 공격자에 의해 패턴이 간파될 수 있다는 것을 의미하므로 공개 키 암호 방식 알고리즘은 대칭 키 방식과 동등한 수준의 보안을 제공하기 위해 훨씬 더 긴 키를 사용한다. 일반적으로 128비트의 대칭 키와 2048 비트의 공개 키가 비슷한 수준의 보안을 제공한다.

2. 연산 속도

   대칭 키 암호방식은 연산이 단순하기 때문에 연산 속도가 빠르다. 반면 공개 키 암호 방식은 복잡한 수학적 연산을 수행해야 하므로 비교적 느리며 키 길이가 길기 때문에 훨씬 더 많은 연산 능력이 필요하다.

3. 보안

   대칭 키 암호 방식에서는 단일한 개인 키를 공유해아 하기 때문에 키 노출 시 보안 위협이 크다. 반면 공개 키 암호 방식은 암호화할 때 공개 키를 사용하고 복호화할 때는 개인 키를 사용하여 이러한 문제를 해결한다.

4. 알고리즘

   잘 알려진 대칭 키 암호 방식 알고리즘에는 RC4, AES, DES, 3DES 등이 있으며, 공개 키 암호 방식 알고리즘에는 RSA, 디피-헬먼, ECC 등이 있다.

### 비대칭 키 암호 방식 알고리즘

#### RSA 암호 방식 (소인수분해)

RSA 암호 방식은 두 개의 소수를 곱하여 얻어낸 계수를 사용해 공개 키와 개인 키를 생성한다. 이 방식은 아주 큰 수는 소인수분해하는 것이 어렵다는 것에 기반을 둔 방식이다. 그렇기에 큰수의 소인수분해를 빠르게 할 수 있는 알고리즘이 발견된다면 RSA 암호 방식은 더 이상 쓰이지 않을 것이다.

A * B = C

매우 긴 숫자를 소인수 분해 하는 것은 많은 기간이 소요된다.

하지만 A와 B를 곱하는 것은 아주 쉽다. 이러한 점들을 사용해 개인 키 암호 방식을 구현할 수 있다.

개인키 * 개인키 = 공개키

-> 개인 키와 개인 키를 곱하는 것은 아주 쉽기에 공개 키를 유추할 수 있다.

-> 그러나 공개 키를 소인수 분해하려면 엄청난 시간이 걸리게 된다. 개인 키를 유추할 수 없다.

-> 공개 키를 전달하여 암호화를 하고, 개인 키를 사용하여 복호화를 할 수 있다.

#### 타원 곡선 알고리즘

타원곡선 알고리즘은 비트코인의 비대칭키 알고리즘으로 유명하다. RSA보다 짧은 키의 길이와, 빠른 연산 속도를 가지지만 동일한 수준의 보안 강도를 가지고 있기 때문에 RSA의 대안으로 나왔던 알고리즘이다.

타원곡선 알고리즘은 위의 RSA와 마찬가지로 유한한 시간 이내에 계산이 가능하지만 실제로 계산하기엔 너무 큰 시간을 할애한다는 점을 중점으로 두고 있다.
<center>
<img src="../../images/2022-08-29-blockchain_10th/image-20220829150643741.png" alt="image-20220829150643741" style="zoom: 33%;" />
</center>
타원 곡선은 y^2=x^3+ax+b를 만족하는 (x, y)점들의 집합을 의미하며, X축을 중심으로 대칭이 되는 곡선을 말한다.

그리고 타원곡선 그래프에 찍힌 임의의 점에 대한 이산 로그를 구하는 것(타원곡선 뎃셈 연산)이 타원곡선 알고리즘이다. 이 암호화를 통한 경우의 수는 10^77로, 실제로 계산하기란 거의 불가능하다.

아래의 예시에서, P와 Q의 덧셈은 점 P와 Q를 지나는 직선이 타원과 만나는 제 3의 교점 -R을(타원곡선으로 이은 교점) x축으로 대칭시킨 R로 정의한다.

P와 Q가 같은 경우에도 P점에서 타원곡선으로 이은 교점을 -R의 X축인 R로 정의한다.
<center>
<img src="../../images/2022-08-29-blockchain_10th/image-20220829151352262.png" alt="image-20220829151352262" style="zoom: 50%;" />
</center>
그리고 이 타원곡선 알고리즘을 N번 덧셈 연산을 한다면 개인 키를 생성할 수 있다.

A(임의의 점, 개인 키) * B(이동 횟수, 개인 키) = C(결괏값, 공개 키)

임의의 점으로부터 타원 곡선 덧셈 연산을 하고, 나온 결괏값을 다시 임의의 점으로 지정하여 타원곡선 뎃셈 연산을 한다. 그렇게 N번의 덧셈 연산을 하여 나온 결괏값이 공개키가 된다.

이 결괏값을 가지고 임의의 점 A와 이동 횟수인 B를 찾는다는 것은 매우 어렵다.

또한 비트코인의 개인 키에 해당하는 B인 이동 횟수는 2^256승의 경우의 수안에서 무작위로 생성되기 때문에 개인 키를 예측한다는 것은 사실상 불가능하다. 2진수로 표현하게 되면 매우 길어지기 때문에 보통 16진수의 64자리로 표현하게 되는데, 이것이 블록체인에서 흔하게 볼 수 있는 그 문자열이다.

공개 키도 마찬가지로 결괏값은 C를 사용하여 보통 지갑 주소로 활용하지만, 보안과 길이 측면에서 한번 더 해시한 값을 활용한다.

### 디지털 서명

디지털 서명(Digital Signature)은 메시지나 디지털 문서의 진위성과 무결성을 검증하는 데 사용하는 수학적 메커니즘이다. 디지털 서명은 일반적인 손으로 쓴 서명이나 도장의 디지털 버전이지만 보다 복잡하여 보안이 우수하다. 디지털 서명은 디지털 통신에서 변조 및 사칭 문제를 해결하기 위한 것으로, 전자 문서, 거래, 메시지의 출처, 신원 및 상태에 대한 보증을 제공할 수도 있다.

#### 디지털 서명의 동작 방식

디지털 서명은 크게 해싱, 서명, 검증 세 단계로 나뉜다.
<center>
<img src="../../images/2022-08-29-blockchain_10th/image-20220829152138439.png" alt="image-20220829152138439" style="zoom: 33%;" />
</center>
1. 해싱

   원본 데이터를 해싱한다. 원본 데이터의 크기는 제각기 다를 수 있지만 해싱되었을 때는 동일한 길이의 해시값을 가지게 된다. 원본 데이터를 해싱하는 것은 필수적인 것은 아니다. 해싱하지 않은 원본 데이터에 개인 키로 서명을 할 수도 있기 때문이다. 그러나 해싱을 함으로써 고정된 길이의 값을 비교하는 것이 무결성을 검증하는데 훨씬 간편하기 때문에 일반적으로 데이터를 해싱한다.

2. 서명

   비대칭 키 암호화 방식을 사용해 해싱된 데이터에 서명을 한다. 서명을 하는 방식은 다양하지만 일반적으로 송신자의 개인 키로 해시값을 암호화한다. 이 암호화된 결과값이 바로 디지털 서명이다.

   디지털 서명은 개인 키로 암호화 되었기 때문에 공개 키로 복호화할 수 있으며, 정상적으로 복호화될 경우 원본 데이터의 해시값이 나오게 된다.  
   서며이 완료되면 송신자는 원본 데이터와 디지털 서명, 송신자의 공개 키를 함께 전송한다.

3. 검증

   수신자는 송신자의 공개 키를 가지고 디지털 서명을 복호화한다. 디지털 서명이 송신자의 개인 키에 의 해 암호화되었다면 원본 데이터의 해시값이 나올 것이다. 또한 수신자는 원본 데이터를 해싱하여 데이터의 해시값을 구한다. 이 두 해시값을 비교하여 만약 해시값이 맞다면, 데이터가 정상적으로 송신자에 의해 서명된 것임을 확인할 수 있다.
   <center>
   <img src="../../images/2022-08-29-blockchain_10th/image-20220829152925280.png" alt="image-20220829152925280" style="zoom: 33%;" /></center>
   
   

#### 디지털 서명의 특징

- 무결성

  수신자는 메시지가 전송되는 동안 위변조가 일어나지 않았음을 검증할 수 있다. 만약 송신자의 공개 키로 디지털 서명을 복호화한 값이 원본 데이터를 해싱한 값과 다른 경우, 해당 송신자의 개인 키로 암호화된 서명이 아니거나, 원본 데이터가 훼손되었을 수 있다.

- 진위성

  송신자의 개인 키가 안전하게 보관되었다는 전제하에, 수신자는 디지털 서명이 송신자에 의해 생성되었음을 확인할 수 있다.

- 부인방지

  송신자의 개인키가 안전하게 보관되었다는 전제하에, 서명이 생성되고 나면이 서명이 송신자에 의해 서명되었다는 사실을 부정할 수 없다.

#### 디지털 서명 시스템의 필요 조건

- 알고리즘

  신뢰할 수 있고, 널리 사용되어 그 안전성이 입증된 해시 함수와 암호화 알고리즘을 사용해야 한다.

- 구현

  디지털 서명 방식은 데이터의 무결성 및 진위성과 직결되기 때문에 결점 없는 시스템을 구현하는 것 역시 중요하다.

- 개인키

  개인 키가 유출되거나 손상될 경우, 진위성과 부인 방지 속성이 무효화된다. 특히 암호화폐에서 개인 키를 잃어버릴 경우 재정적 손실로 이어지기도 한다.

블록체인에서 디지털 서명은 송금을 위해 트랜잭션을 생성하여 서명하고 승인하는데 사용된다. 특히 월렛 방식을 사용하는 비트코인에서는 개인 키를 소유한 사람만이 코인을 사용할 수 있기 때문에 개인 키를 안전하게 보호하는 것이 중요하다.



### 해시 함수

해싱(Hashing)은 다양한 크기의 입력값을 고정된 크기의 출력값으로 생성해 내는 과정을 의미한다.

해시 함수는 어떠한 크기의 입력이 들어와도 동일한 크기의 출력을 뱉는 함수이다. 원본이 조금이라도 바뀌어도 결괏값이 전혀 달라지며, 출력값을 통해 입력값을 유추할 수 없다.
<center>
<img src="../../images/2022-08-29-blockchain_10th/image-20220829155132945.png" alt="image-20220829155132945" style="zoom: 33%;" />
</center>


#### 블록체인에서 해싱의 역할

기존의 해싱은 데이터베이스 조회, 파일 분석, 데이터 관리 등에 사용되어 왔다. 반면, 암호 해시 함수는 메시지 인증, 디지털 서명 등 보안 애플리케이션에서 사용될 수 있다.

특히 암호화폐 프로토콜에서 가장 중요한 기술 중 하나로, 사용자에게 익명성을 보장하고, 트랜잭션을 하나로 연결 및 압축하며, 블록을 연결하는 동시에 그 무결성을 보장하는 역할을 한다.

1. 해시값을 사용해 익명성 보장

   공개키를 해싱한 값을 지갑 주소로 사용하여 거래를 익명화할 수 있다.

   트랜잭션 기록에는 **해시값으로 암호화된 지갑 주소와 송금 및 잔액을 확인할 수 있을 뿐**, 해당 지갑의 주인이 누구인지 파악할 수는 없다.

2. 무결성 검증

   입력값이 조금이라도 다르면 출력값이 변하는 해시 함수의 특성을 이용하여 연결되어 있는 블록체인에서 무결성을 검증할 수 있다.

3. 해시값을 사용해 채굴 노드를 정함

   최초의 블록체인 암호화폐인 비트코인에서는 PoW(작업 증명)방식을 사용해 어떤 노드가 블록을 만들지 정한다. 작업 증명 방식에서는 특정 조건을 만족하는 해시값을 만족하기 위해 입력값인 논스(Nonce)를 찾아야 한다. 이를 가장 먼저 찾는 노드에게 블록을 채굴할 권한을 주며 채굴에 대한 보상으로 비트코인을 제공한다.

#### 암호 해시 함수

블록체인에서 사용되는 해시 함수는 단방향 알고리즘을 사용하고, 입력값이 조금만 달라져도 아예 다른 형태로 변하기 때문에 해싱된 값을 이용하여 기존의 값을 찾기란 매우 어렵다. 그렇기에 해시 함수는 일방향 일반적으로 암호 해시 함수를 복호화하기 위해서는 수많은 대입을 시도해야 한다.

해시 함수의 약점에서는 특징 중 하나인 '항상 고정된 길이의 출력값' 때문에 발생하는 문제점이 있다. 서로 다른 입력값을 해시 함수에 넣었는데 동일한 출력값을 내뱉는 경우이다. 이를 **해시 충돌**이라고 한다. 해시 충돌은 시스템에 심각한 위협이 될 수 있기 때문에 충돌은 해시 함수를 만들 때 가장 중요한 요소 중 하나로 작용한다.

암호 해시 함수의 안전성을 평가하는 요소 세가지

- 충돌 저항성

  어떤 해시 함수가 충돌하는 서로 다른 두 입력값을 가졌는지 발견되지 않은 상태를 의미한다.

- 역상 저항성

  어떤 해시 함수가 특정한 값을 출력하는 입력값을 찾을 확률이 매우 낮을 경우를 의미한다.

  역상 저항성은 데이터를 보호하는데 매우 유리하다. 메시지의 해시값을 사용하면 해당 메시지의 원본을 공개하지 않고도 진위성을 검증할 수 있기 때문이다.

- 제2 역상 저항성

  충돌 저항성과 역상 저항성이 복합적으로 작용한 경우로, A라는 입력값의 해시값과 동일한 해시값을 내는 B입력값을 누군가가 알고 있지 않은 경우이다.

  충돌 가능성은 동일한 해시값을 가진 서로 다른 두 입력값을 찾는 것이지만, 제 2역상 공격은 A 입력값을 통해 A'라는 해시값이 나왔을때, A'해시값을 출력하게 만드는 B입력값을 찾는 것이다. 따라서 제2 역상 저항성은 충돌 저항성이 전제되어야 한다.

### 다양한 암호화 기술

#### SHA

SHA는 Secure Hash Algorithm의 약자로 해시함수를 이용해 만든 해시 암호화 알고리즘의 모음이다.

일반적으로 암호화 알고리즘은 데이터를 숨기고 안전하게 전달하는 기밀성이 그 목적이지만, SHA의 목적은 데이터의 위변조가 불가능함을 보장하는 **무결성**이다.

#### ECDSA

ECDSA(Elliptic Curve Digital Signature Algorithm; 타원곡선 디지털 서명 알고리즘)는 비대칭 키 방식 중 하나인 ECC에 디지털 서명 방식을 접목한 알고리즘이다.

#### HMAC

HMAC은 Hash-based Message Authentication Code의 약자로, 대칭 키 암호 방식을 사용하여 디지털 서명을 구현한다. HMAC은 송신자와 수신자가 단일 키를 공유하고, 해당 단일 키와 원본 데이터를 해싱한 값과 원본 데이터를 함께 트랜잭션으로 보내 데이터의 무결성을 증명한다.

HMAC의 디지털 서명 공식은 다음과 같다.

```
HMAC 트랜잭션 = HASH(원본 데이터, 단일 키) + Message
```

공개키 암호 방식에서는 개인 키로 원본 데이터의 해시값에 서명하고, 공개키로 이를 복호화하여 원본 데이터와 비교했지만, HMAC에서는 단일 키와 원본데이터로 만든 해시값이 서명의 역할을 한다.

#### PKI

PKI(Public Key Infrastructure, 공개 키 인프라)는 디지털 인증서와 공개 키를 생성, 관리, 배포, 사용, 저장 및 해지하는데 필요한 일련의 하드웨어, 소프트웨어, 정책, 프로세스와 절차의 집합니다. PKI는 대규모 사용자 집단에서 디지털 서명 및 암호화와 같은 기술을 사용할 수 있는 기반이다. PKI의 목적은 데이터를 안전하게 전송하는 것이며, 이를 위해 시스템 및 리소스 접근 권한, 데이터 보호, 트랜잭션 무결성 및 진위성, 기밀성을 보장한다.

PKI는 공개 키 암호 방식을 사용하여 웹 서버, 임베디드 시스템, 서로 연결된 장치, 비즈니스 프로세스를 실행하는 소프트웨어 간에 데이터를 안전하게 교환할 수 있도록 한다. 오늘날 비즈니스 모델은 전자 상거래나 전자 문서에 점점 더 의존하면서 진화하고 있으며, 인터넷 장치들은 기업 네트워크에 더 많이 연결되고 있다.

#### 슈노르 서명

일반적인 디지털 서명에서는 공개 키, 서명할 메시지 및 서명이 포함되어 있으며 공개 키의 소유자가 주어진 메시지에 서명했음을 보여준다.

슈노르 서명에서는 키 집합(Key Aggregation)을 사용한다. 슈노르 서명은 서명하는 당사자의 공개 키들을 결합하여 단일한 하나의 공개 키를 구성한다. 그리고 각 당사자의 개인키를 사용하여 해당 메시지에 서명을 할 수 있다. 또한 당사자들의 서명을 결합하여 합쳐진 단일 공개 키에 유효한 단일 서명을 구성할 수 있다. 검증 노드가 당사자들이 모두 메시지에 서명했는지 확인할 때는 단일 서명과 단일 공개키로 확인할 수 있다.
