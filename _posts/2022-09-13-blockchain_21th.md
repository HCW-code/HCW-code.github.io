---
layout: single
title: "[블록체인] 노드(Node)의 의미"
categories: blockchain
tag: [node, 노드]
toc: true


---

### 자료구조에서의 노드

개발자에게 노드라는 개념은 하나의 단위로 여겨진다. 연결리스트는 노드라는 객체로 이루어져 있다.

연결리스트 - 순서를 가지는 자료들의 저장과 탐색을 위해 각 데이터에 이전 데이터나 이후 데이터의 참조를 추가로 기록하여 자료들을 연결하는 자료구조

사용자가 입력하는 정보를 Data영역에 담고 노드가 추가될 때마다 Next Address를 이용하여 다음 노드와 연결한다.
<center>
<img src="../../images/2022-09-13-blockchain_21th/image-20220913132319246.png" alt="image-20220913132319246" style="zoom: 33%;" />
</center>
이처럼 각 노드는 연속된 공간에 저장되어 있지 않고 메모리의 여러 부분에 분포되어 있다.

각 노드에 다음 노드의 주소를 저장함으로써 다음 노드를 탐색할 수 있다. 다음 주소를 가리ㅕ야 하므로 포인터를 이용해 구현할 수 있다.

노드가 가리키는 다음 주소가 NULL이면 이 노드는 마지막 노드라고 할 수 있다.

#### 연결리스트 구현

- 초기화(Init)

  노드에 접근하기 위해서는 맨 처음 노드의 주소를 가리킬 노드인 Head가 필요하다.  
  맨 마지막 노드를 가리키는 노드는 Tail이다.

  초기화하는 과정에서 다음주소를 가리키는 포인터는 NULL로 설정한다.
<center>
  <img src="../../images/2022-09-13-blockchain_21th/image-20220913132707623.png" alt="image-20220913132707623" style="zoom: 33%;" />
</center>
   

- 삽입(Insert)
  <center>
  <img src="../../images/2022-09-13-blockchain_21th/image-20220913132756659.png" alt="image-20220913132756659" style="zoom: 33%;" />
  </center>
  1. 앞에 삽입
  <center>
     <img src="../../images/2022-09-13-blockchain_21th/image-20220913132923658.png" alt="image-20220913132923658" style="zoom:33%;" />
  </center>
  2. 마지막에 삽입
  <center>
     <img src="../../images/2022-09-13-blockchain_21th/image-20220913132940783.png" alt="image-20220913132940783" style="zoom:33%;" />
  </center>
  3. 원하는 위치에 삽입

     삽입할 위치를 찾는 노드 cur가 필요하다.
  <center>
     <img src="../../images/2022-09-13-blockchain_21th/image-20220913133025786.png" alt="image-20220913133025786" style="zoom:33%;" />
  </center>
  

- 삭제(Remove)

  삭제는 원하는 자리에 삽입하는 과정과 유사하다.  
  그러나 삭제할 노드의 전과 삭제할 노드의 후를 연결해줘야 하므로 또 하나의 노드인 pre가 필요하다.
  <center>
  <img src="../../images/2022-09-13-blockchain_21th/image-20220913133204693.png" alt="image-20220913133204693" style="zoom:33%;" />
  </center>
  1. 탐색을 통해 삭제할 노드를 cur이 가리키게 하고, 삭제할 노드의 바로 전 노드를 pre가 가리키게 한다.
  2. pre가 가리키는 노드의 다음 주소가 cur이 가리키는 다음 주소를 가리키게 한다.
  3. cur이 가리키는 노드는 노드의 메모리 주소를 비워준다.

### 블록체인에서의 노드

블록체인의 노드는 트리 구조로 되어 있다.

블록체인에서 노드는 전 세계적으로 수십만 개 이상이 존재하는 서버들을 노드라고 한다.

노드는 기능과 필요에 따라 종류와 형태가 구별되고, 자신이 맡은 역할에 따라 다양한 기능을 수행한다. 즉, 노드를 서버(Server)라고 했을 때, 서버의 역할이 데이터 저장만 하는 게 아닌 것처럼 노드 역시 다양한 기능을 수행하게 된다.

노드는 트랜잭션을 제안하고 검증할 수 있으며, 합의를 이루고, 블록체인을 보호하기 위해 채굴(Mining)을 수행하기도 한다.

또 다른 면으로는 계정의 역할도 하므로 프라이빗 블록체인(Private Blockchain) 또는 하이퍼레저 패브릭의 멤버십 서비스 같은 폐쇄형 블록체인 네트워크에서는 계정 역할의 노드가 꼭 필요하다.

블록체인(비트코인)의 노드는 아래 4가지 기능 조합의 다양한 형태로 노드가 형성된다.
<center>
<img src="../../images/2022-09-13-blockchain_21th/image-20220913135432322.png" alt="image-20220913135432322" style="zoom:33%;" />
</center>
### 노드의 종류

**풀노드(Full Node)**

풀 노드는 블록체인에서 이뤄진 모든 거래 정보를 전부 저장하는 노드이다. 제네시스 블록부터 시작해서 현재 블록까지 모든 블록체인 정보를 수집, 저장한다.  
풀 노드는 자신의 PC에 모든 블록체인의 내용을 가지고 있기 때문에 다른 노드의 도움 없이 스스로 거래 검증이 가능하다. 하지만 용량이 너무 커서 다운로드를 받는데 시간이 오래걸리고 하드디스크의 용량을 많이 차지한다는 단점이 있다.

제네시스 블록은 블록체인에서 생성된 최초의 블록이다. 제네시스 블록의 코인베이스 매개 변수에는 일반 데이터와 함께 다음 텍스트가 포함되어 있다.
<center>
<img src="../../images/2022-09-13-blockchain_21th/image-20220913135911992.png" alt="image-20220913135911992" style="zoom:50%;" />
</center>
**라이트 노드(Light Node)**

풀 노드의 단점을 해결하기 위해 나온 것이 바로 라이트 노드이다. 라이트 노드는 블록체인에 참여하여 거래를 수행하는 노드로, 풀 노드에 거래 데이터를 요청하여 개별 거래를 검증하는 기능을 수행한다. 풀 노드처럼 모든 블록 정보의 원본을 가지고 있지는 않고 일종의 요약본, 즉 블록헤더에 있는 중요한 데이터만 보유하고 있게 된다.

**SPV(Simple Payment Verification)**

SPV 노드는 라이트웨이트 노드와 동일한 개념으로 말 그대로 **단순 지불 검증 노드**로서 전체 블록체인을 저장하지 않아도 특정 거래를 확인할 수 있는 노드이다. SPV노드는 거래를 확인할 수 있지만 직접 검증할 수 없다. 해당 노드는 거래가 담긴 블록의 깊이와 높이를 참고하여 단순 검증(안전하게 보관되었다는 검증)은 할 수 있지만 거래 전부에 대한 기록이 없기에 직접 검증(거래 자체가 적합한지)은 불가능하다. UTXO의 소비 여부 또한 검증할 수 없다.

SPV노드는 이웃 노드들에게 지불 검증을 위해 필요한 데이터를 요청하게 된다. 하지만 이러한 과정에서 SPV 노드는 자연스레 프라이버시를 노출하게 된다. 즉, 필요한 데이터가 무엇인지 그대로 전달해야 한다. 이러한 점을 보완하기 위해 '블룸필터(Bloom Filter)'를 사용하여 원하는 데이터를 얻으면서 프라이버시를 유지할 수 있게 된다.

**마스터 노드(Master Node)**

마스터 노드는 풀 노드중에서 권한과 보상을 받은 노드로 주인 혹은 상위 노드로 표현된다. 풀 노드는 블록체인 데이터를 전부 저장해 네트워크에 기여하는 의무를 갖고 있고, 마스터 노드는 풀 노드의 의무를 수행하면서 블록 생성에 대한 보상(투표 실시)을 받고, 트랜잭션의 추가기능(익명, 즉시 전송)을 수행한다.

**채굴 노드(Mining Node)**

채굴 노드의 역할은 새로운 블록을 가능한 한 빠르게 채굴하는 것이다. 채굴 노드는 작업 증명(PoW) 방식을 채택한 블록체인에만 존재하는데, 채굴은 실질적으로 작업증명 방식에서 퍼즐을 푸는 일이기 때문이다.

**랜덤 노드(Random Node)**

랜덤 노드는 전체 블록체인의 무결성을 유지하기 위해 임의로 선택된 노드로서, 선출된 마스터 노드와 함께 블록을 생성한다.

**엔드포인트 노드(Endpoint Node)**

엔드포인트 노드는 카카오의 자회사인 그라운드X가 개발한 플랫폼인 클레이튼에 적용된 노드이다.  
엔드폰인트 노드는 정기적으로 다른 엔드포인트들과 통신하며 후술할 합의 노드에서 새롭게 생성된 블록을 다운로드하고 블록체인의 사본을 저장하는 식으로 블록을 이중으로 확인하는 노드이다.  
누구나 엔드포인트 노드로 네트워크에 기여할 수 있으며, 참여자는 대가로 클레이 보상을 받을 수 있다.

**합의 노드(CN; Consensus Node)**

합의 노드는 트랜잭션을 새로운 블록으로 배치하고 비잔틴 장애 허용(BFT; Byzantine Fault Tolerance) 합의 알고리즘을 사용하여 블록들을 확인하는 작업을 담당하는 합의 네트워크를 형성하는 노드이다. 블록체인에서 블록을 생성하는 노드로 블록체인을 유지하기 위해서는 합의 노드가 존재하여야 하며 스마트 계약 실행이나 거래 확인은 합의 노드에서 수행하게 된다.

**슈퍼 노드(Super Node) 또는 대표 노드(Representative Node)**

대표 노드(슈퍼 노드)는 블록체인 네트워크의 노드들을 대표해 블록을 생성하고 그에 대한 보상을 받는 노드 위임지분 증명(DPoS)합의 알고리즘을 채택하고 있는 블록체인에서 특징적으로 볼 수 있는 시스템이다.

**베이킹 노드(Baking Node)**

베이킹 노드는 테조스 블록체인에서 사용하는 용어로 코인 소유자로부터 위임받은 코인으로 베이킹하는 노드이다. 베이킹은 테조스 블록에서 블록을 생성하고 블록을 입증하는 방법으로, 채굴과 동일한 의미를 가진다.

**히스토리 노드(History Node)**

히스토리 노드란  블록에 있는 데이터를 찾을 수 있는 노드이다. 이더리움 API 서비스 제공 업체인 인퓨라는 이 히스토리 노드의 데이터를 이용한 새로운 BM을 운영하기도 한다.

### 노드 - Network Routing

네트워크 라우팅은 경로 정보를 기반으로 현재의 네트워크에서 다른 네트워크로 최적의 경로를 통해 데이터를 전송하는 기법으로, 모든 노드가 기본적으로 가지고 있는 기능이다.

블록체인상의 P2P 네트워크 전송기능을 담당한다.

이와 같은 4가지 기능의 조합으로 다양한 노드가 형성된다.

1. Reference Client

   모든 노드를 포함한 완전한 네트워크의 형태이다. Bitcoin Core가 여기에 해당된다.
   <center>
   <img src="../../images/2022-09-13-blockchain_21th/image-20220913144605206.png" alt="image-20220913144605206" style="zoom:33%;" />
   </center>
2. Full Blockchain Node

   네트워크 라우팅 기능과 모든 블록체인 데이터를 가진 형태이다.
   <center>
   <img src="../../images/2022-09-13-blockchain_21th/image-20220913144640526.png" alt="image-20220913144640526" style="zoom:33%;" />
   </center>
3. Solo Miner

   지갑 기능은 제외하고 채굴에 특화된 형태의 노드이다.
   <center>
   <img src="../../images/2022-09-13-blockchain_21th/image-20220913144707847.png" alt="image-20220913144707847" style="zoom:33%;" />
   </center>
4. Lightweight Wallet

   지갑 기능과 네트워크 라우팅 기능만 포함된 노드로 전체 블록체인 데이터는 없이 단순히 거래와 유효성 검증만 가능한 스마트폰에 설치된 지갑 등과 같은 노드이다.

   Full Blockchain 데이터는 170기가가 넘는 용량을 차지하기 때문에 스마트폰에는 Full Blockchain Node의 형태로 설치하기가 불가능할 수 있다.

   
   <center>
   <img src="../../images/2022-09-13-blockchain_21th/image-20220913145109892.png" alt="image-20220913145109892" style="zoom:33%;" />
   </center>
   

   

모든 노드는 Network Routing 기능을 포함하고 있다.

### 블록체인의 분기

채굴노드에서 채굴에 성공된 블록이 인근 노드로 전파가 시작되면 해당 블록을 전달받은 노드들은 그 블록의 유효성을 검사하여 유효한 경우 자신의 메인체인에 블록을 연결하여 블록체인의 길이를 연장하고 다시 인근 노드로 블록을 전달한다. 이 과정이 순차적으로 이루어져 전체 블록체인에 동일한 블록이 추가되게 된다.

하지만 동시에 두 개의 유효한 블록이 생성되어 전파되는 경우 일시적으로 블록체인이 두 개의 브랜치로 분기가 발생할 수 있다.

다음 그림은 파란색 블록을 가장 최상위 블록으로 가지고 있는 블록체인을 나타내고 있으며, 모든 노드가 동일한 파란 블록을 부모 블록으로 가지고 있다.
<center>
<img src="../../images/2022-09-13-blockchain_21th/image-20220913152447174.png" alt="image-20220913152447174" style="zoom:33%;" />
</center>
다음 그림은 동시에 다른 지역에서 각자 유효한 블록을 생성하여 전파는 과정이다.
<center>
<img src="../../images/2022-09-13-blockchain_21th/image-20220913152540003.png" alt="image-20220913152540003" style="zoom: 33%;" />
</center>
각자 생성된 블록이 모든 노드에 전파가 완료되면 다음 그림과 같이 빨간색 블록과 초록색 블록이 마지막 블록으로 이루어진 두개의 블록체인으로 분기가 발생하게 된다.

이 과정에서 초록색 블록으로 확장된 노드에서는 뒤늦게 도착한 빨간색 블록은 무시하게 되고, 마찬가지로 빨간색 블록으로 확장된 노드는 뒤늦게 도착한 초록색 블록은 무시하게 된다.
<center>
<img src="../../images/2022-09-13-blockchain_21th/image-20220913152719143.png" alt="image-20220913152719143" style="zoom:33%;" />
</center>
이후에 초록색 블록을 부모 블록으로 가지는 노드에서 새롭게 분홍색 블록을 생성하여 전파를 시작한다.
<center>
<img src="../../images/2022-09-13-blockchain_21th/image-20220913152812705.png" alt="image-20220913152812705" style="zoom: 33%;" />
</center>
전파가 진행된 결과 다음 그림과 같이 초록색 블록을 부모 블록으로 가지는 노드는 정상적으로 확장이 진행되지만, 빨간색 블록을 부모로 가지는 노드는 2개의 블록체인으로 분기가 된다.

분기가 발생하게 되는 경우 가장 많은 수의 블록으로 구성된 체인이 그만큼 유효한 작업 증명이 이루어졌다고 판단해서 파란색 -> 초록색 -> 분홍색 블록으로 구성된 체인을 메인체인으로 선택하게 되고, 빨간색 블록에 포함되어 있던 거래는 다시 거래 풀에 들어가 새로운 블록 생성을 위해 대기하게 된다.
<center>
<img src="../../images/2022-09-13-blockchain_21th/image-20220913153055623.png" alt="image-20220913153055623" style="zoom:33%;" />
</center>
이처럼 순간적으로 블록체인의 분기가 발생하게 되더라도 바로 다음 블록의 생성 시점에 하나의 메인체인으로 수렴이 이루어지게 된다.