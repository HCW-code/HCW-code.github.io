---
layout: single
title: "[Database] SQL, 데이터베이스"
categories: database
tag: [sql, database, acid]
toc: true
---

### SQL(Structured Query Language)

- 구조화된 Query 언어
- 데이터베이스 용 프로그래밍 언어
- 데이터베이스에 query를 보내 원하는 데이터 추출 가능

Query

- 직역을 하자면 "질의문"
- 예시로 검색창에 적는 검색어도 Query의 일종
- 저장되어있는 정보를 필터 하기 위한 질문

### **데이터베이스의 필요성**

1. In-Memory

   JavaScript에서 변수를 만들어 저장한 경우, 프로그램이 종료될 때 해당 프로그램이 사용하던 데이터도 사라진다. 이 말은 변수 등에 저장한 데이터가 프로그램의 실행에 의존한다는 말이다. 예기치 못한 상황으로부터 데이터를 보호할 수 없고, 프로그램이 종료된 상태라면 데이터를 원하는 시간에 받아올 수 없으며 데이터의 수명이 프로그램의 수명에 의존하게 된다.

2. File I/O

   파일을 읽는 방식으로 작동하는 형태를 말한다. 엑셀 시트나 CSV같은 파일의 형태는 In-Memory에 비해 데이터를 저장하는 방식으로 적절하지만 한계가 존재한다.

   - 데이터가 필요할 때마다 전체 파일을 매번 읽어야한다.
   - 파일이 손상되거나 여러 개의 파일들을 동시에 다뤄야 하거나 하는 등 복잡하고 데이터량이 많아질수록 데이터를 불러들이는 작업이 힘들어진다.

관계형 데이터베이스는 하나의 CSV파일이나 엑셀 시트를 한 개의 테이블로 저장할 수 있으며 한번에 여러개의 테이블을 가질 수 있기 때문에 SQL을 활용해 데이터를 불러오기 수월하다.



### **데이터베이스 관련 명령어**

데이터베이스 생성 - 데이터베이스 생성

```sql
CREATE DATABASE 데이터베이스_이름;
```

데이터베이스 사용 - 데이터베이스를 이용해 작업을 하기위해 사용하겠다는 명령을 전달

```sql
USE 데이터이스_이름;
```

테이블 생성 -  user 테이블 생성

```sql
CREATE TABLE user(
	id int PRIMARY KEY AUTO_INCREMENT,
	name varchar(255),
	email varchar(255)
);
```

테이블 정보 확인

```sql
DESCRIBE user;
```

### **SQL 명령어**

SELECT - 데이터셋에 포함될 특성을 특정한다.

FROM - 테이블과 관련한 작업을 할 경우 반드시 입력, FROM 뒤에는 결과를 도출해낼 데이터베이스 테이블을 명시한다.

WHERE - 필터 역할을 하는 쿼리문

ORDER BY - 돌려받는 데이터 결과를 어떤 기준으로 정렬하여 출력할지 결정

LIMIT - 결과로 출력할 데이터의 갯수를 정한다, 쿼리문에서 가장 마지막에 추가

DISTINCT - 유니크한 값을 받고 싶을 때 사용

INNER JOIN - 조인하는 테이블의 ON절의 조건이 일치하는 결과만 출력

OUTER JOIN - 조인하는 테이블의 ON절의 조건 중 한쪽의 데이터를 모두 가져온다.

<br>

### **추가**

**여러 쿼리문을 한 번에 써보기**

다음은 Brazil에서 온 고객을 도시별로 묶은 뒤에 각 도시 수에 따라 내림차순 정렬한다. 그리고 CustomerId에 따라 오름차순으로 정렬한 3개의 결과만 요청하는 예시이다.

```sql
SELECT c.CustomerId, c.FirstName, count(c.City) as 'City Count'
FROM customers AS c
JOIN employees AS e ON c.SupportRepId = e.EmployeeId
WHERE c.Country = 'Brazil'
GROUP BY c.City
ORDER BY 3 DESC, c.CustomerId ASC
LIMIT 3
```

### ACID

ACID는 데이터베이스 내에서 일어나는 하나의 트랜잭션(transaction)의 안전성을 보장하기 위해 필요한 성질이다.

- Atomicity(원자성)

  원자성은 하나의 트랜잭션에 속해있는 모든 작업이 전부 성공하거나 전부 실패해서 결과를 예측 할 수 있어야 한다.

  SQL에서도 특정 쿼리를 실행했는데 부분적으로 실패하는 부분이 있다면 전부 실패하도록 구현되어 있다. 때때로 충돌 요인에 대해서 선택지를 제공한다.

- Consistency(일관성)

  데이터베이스의 상태가 일관되어야 한다는 성질이다. 하나의 트랜잭션 이전과 이후, 데이터베이스의 상태는 이전과 같이 유효해야 한다. 다시 말해, 트랜잭션이 일어난 이후의 데이터베이스는 데이터베이스의 제약이나 규칙을 만족해야 한다는 뜻이다.

- Isolation(격리성, 고립성)

  Isolation은 모든 트랜잭션은 다른 트랜잭션으로부터 독립되어야 한다는 뜻이다. 실제로 동시에 여러개의 트랜잭션들이 수행될 때, 각 트랜젝션은 고립(격리)되어 있어 연속으로 실행한 것과 동일한 결과를 나타낸다.

- Durability(지속성)

  Durability는 하나의 트랜잭션이 성공적으로 수행되었다면 해당 트랜잭션에 대한 로그가 남아야 된다. 만약 런타임 오류나 시스템 오류가 발생하더라도 해당 기록은 영구적이어야 한다는 뜻이다.