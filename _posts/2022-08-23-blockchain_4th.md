---
layout: single
title: "[블록체인] 블록체인의 구성요소"
categories: blockchain
tag: [blockchain,합의 알고리즘, 지갑과 어카운트]
toc: true


---

## 합의 알고리즘

합의 알고리즘(Consensus Algorithm)이란, 다수의 참여자들이 통일된 의사결정을 하기 위해 사용하는 알고리즘을 말한다. 합의 모델, 합의 방식, 합의 메커니즘 또는 합의 프로토콜이라고도 부른다.

블록체인 시스템의 경우 네트워크에 참여하는 모든 참여자들이 동일한 데이터를 복사하여 분산 저장하기 때문에 원본과 사본의 구별이 없으며, 통일된 의사결정을 내릴 수 있는 권위 있는 중앙(Center)이 존재하지 않는다.

블록체인의 데이터는 중앙화된 서버 대신 전세계에 흩어져 있는 수많은 노드에 보관되기 때문에, 각각의 노드들은 블록에 기록하는 데이터가 위변조되지 않은 원본이라는 것을 상호간에 합의하는 과정이 필요하다. 만약 블록을 생성하는 특정 노드가 악의를 품고 조작 데이터를 저장하거나 네트워크에 전파한다면 시스템 전체의 신뢰도가 떨어질 것이다. 이런 악의적인 상황이 발생하더라도 네트워크를 올바른 방향으로 이끌고자하는 다수의 노드들이 상호 검증을 거쳐 올바른 블록 생성을 이끌어내는 프로세스와 알고리즘을 바로 합의(Consensus)라고 한다.

#### 작업 증명(PoW, Proof of Work)

작업 증명은 최초의 블록체인인 비트코인을 창시한 사토시 나카모토가 제안한 합의 알고리즘으로, 블록생성 시간동안 가장 많은 해시파워를 제공한 노드가 블록을 생성할 수 있도록 설계가 되어 있다.

블록을 생성하기 위해 논스라는 임의의 값을 맞히는 과정을 마이닝(Mining, 채굴)이라고 부르는데 블록체인 네트워크에 전송된 암호화된 거래정보를 새로운 블록에 담고, 새로운 블록을 체인에 연결하는 작업을 완료했다는 것을 증명하는데 사용되는 컴퓨팅 파워라고 이해할 수 있다. 작업 증명에서는 브랜치가 생긴 경우 가장 긴 블록체인이 남을 때까지 서로 경쟁하여 이긴 브랜치가 최종적인 브랜치로 채택이 되며, 다른 브랜치는 버려진다.

작업증명은 현재 시빌 공격과 같은 블록체인 네트워크에 대한 각종 공격을 막을 수 있다고 증명된 유일한 알고리즘이다.

그러나 작업 증명에도 단점이 있다. 가령 a, b, c가 채굴을 시작하고 c가 채굴에 성공했을때 a, b가 찾는 논스에 근접했더라도 지금 찾는 논스 값을 계속 찾는 것보다 새로운 블록을 채굴하는게 더 효율적이다. 따라서 채굴에 성공한 하나의 노드를 제외한 나머지 모든 노드들은 에너지 자원을 낭비할 뿐이다.

#### 지분 증명(PoS, Proof of Stake)

지분 증명 알고리즘은 노드 또는 사용자가 시스템에 충분한 지분을 갖고 있다는 아이디어에서 출발한다. 즉, PoS는 지분을 많이 가지고 있는 노드에게 블록을 생성할 권한을 준다. 작업이 아닌 더 많은 지분(해당 코인)을 가지고 있을 수록 그에 비례하여 블록에 기록할 권한이 더 많이 부여된다는 개념이다.

채굴자에게는 마치 이자와 같은 방식으로 코인이 지급되며, 일정 수 이상의 코인을 보관하고 있는 지갑을 블록체인 네트워크에 연결시켜놓기만 하면 보상을 받을 수 있다. 블록 생성자와 지분 생성자의 이해관계를 일치시킴으로써 블록을 나쁜 의도로 생성할 동기부여를 없애며, 잘못 생성할 경우 패널티를 부여한다.

PoW보다 에너지 소모가 적고, 코인을 가진 노드 누구나 네트워크에 허가없이 참여하기 때문에 분산화가 더 잘되어 많은 노드가 의사결정 과정에 쉽게 참여할 수 있다는 이점이 있다.

오늘날 이더리움은 작업 증명 방식에서 지분 증명 방식으로 합의 알고리즘을 변경하려 한다.

#### 위임 지분 증명(DPoS, Delegated Proof of Stake)

위임 지분 증명은 PoS에서 변형된 것으로, 시스템의 지분을 가진 각 노드가 투표를 통해 트랜잭션의 유효성 검사를 다른 노드에 위임하여 증명하는 개념이다.

모든 노드의 자격을 가진 주주들이 블록생성에 참여하는 대신, 네트워크의 모든 노드의 투표 결과로 선출한 '상위 노드'에게 권한을 위임해 합의하도록 하는 방식이다. 일정 수의 증인들은 모든 권한을 위임 받아 블럭 생성을 담당한다.

댄 라리머는 DPoS를 사용하는 그라핀(Graphene) 엔진을 토대로 스팀과 빗쉐어를 만들고 이에 대한 성능을 증명했다. DPoS는 합의에 참여하는 노드의 수가 한정되어 있기 떄문에 매우 빠른 성능과 확장성을 보이고 있지만, 완전히 탈중앙화된 블록체인이 아니라는 비판을 받고 있기도 하다.

### 합의 알고리즘의 종류와 장단점

| 체인 공개 유형           | 합의 방식           | 설명                                                         | 장점                                                    | 단점                                                         | 사용코인                               |
| ------------------------ | ------------------- | ------------------------------------------------------------ | ------------------------------------------------------- | ------------------------------------------------------------ | -------------------------------------- |
| 퍼블릭 비허가형 공개형   | 작업 증명 PoW       | 각 노드의 연상 능력을 증명하여 블록 생성<br />높은 컴퓨팅 파워를 가진 노드가 블록을 생성할 확률이 높음<br />오랫동안 사용되며 안전성이 검증되었지만 단점도 많이 노출 | 오랫동안 검증됨                                         | 51%Attack <br />완결성 문제<br />느린 트랜잭션<br />에너지 낭비 | 비트코인<br />라이트 코인              |
|                          | 지분 증면 PoS       | 소유 지분 양에 비례하여 블록 생성 권한을 높은 확률로 부여 받음<br />많은 지분을 가진 노드가 블록을 생성할 확률 높음<br />이론적으로 우수하지만 실제 대규모 환경에서 검증 사례가 부족 | 51%Attack 내성<br />빠른 트랜잭션<br />에너지 낭비 적음 | 완결성 문제<br />검증 부족                                   | 퀀텀<br />네오<br />스트라디스         |
|                          | 위임 지분 증명 DPoS | 일부 위임된 Validator끼리 PoS 수행 트랜잭션 속도가 더 빠름<br />신뢰도는 Validator의 신뢰도에 종속 | 빠른 트랜잭션<br />에너지 낭비 적음                     | 완전선 문제<br />검증 부족<br />탈중앙성 부족<br />보안 취약 | 스팀<br />이오스<br />아크<br />라이즈 |
|                          | 경과 시간 증명 PoET | 경쟁적 연산으로 낭비되는 에너지를 줄이면서 작업 증명과 유사 효과<br />하이퍼레저 쏘투스 레이크에서 제안<br />인텔 SGX을 기반으로 블록을 생성하는 리더를 랜덤으로 선정 | 검증된 방법의 개선<br />에너지 낭비 적음                | 특정 HW 종속                                                 | 쏘투스                                 |
| 프라이빗 허가형 컨소시엄 | PBTF                | 참가자 1명이 프라이머리(리더)가 되어 모든 참가자에게 요청 송신<br />그 요청에 대한 결과를 집계한 뒤 다수의 값을 사용해 블록을 확정<br />각 노드는 브로드캐스트 된 명령을 받게 되면 모든 노드에 회신<br />각 노드는 명령을 일정 수 이상 수신하면 명령을 실행하고 블록을 등록 | 완결성 문제 해결<br />빠른 트랜잭션                     | 참여자 사전 파악 필요<br />참가자 증가 시 성능 하락          | 페브릭                                 |
|                          | 권한 증명 PoA       | 트랜잭션 및 블록의 Validator라고 승인된 계정에 의해 유효성이 검사 Validator의 권리를 얻으므로 그들이 얻은 지위를 유지하고자 함<br />자신의 신원에 부정적 평판이 생기길 원치 않도록 노력할 거라 가정 |                                                         |                                                              |                                        |
|                          | PAXOS               | 트랜잭션 및 블록의 Validator라고 승인된 계정에 의해 유효성이 검사<br />Validator가 될 수 있는 권리를 얻으므로 그들이 얻은 지위를 유지하고자 함<br />자신의 신원에 부정적인 평판이 생기길 원치 않도록 노력할 것이라는 가정 |                                                         |                                                              |                                        |
|                          | RAFT                | 리더를 선정한 후 시스템의 모든 변화를 리더를 통해 결정<br />신뢰된 네트워크에서만 사용 |                                                         | 리더의 조작 가능<br />BTF 보장하지 않음                      |                                        |
|                          | Sieve               | IBM에서 고안한 PBFT확장 알고리즘 실행결과 전송과 집계 결과 전송으로 흐름이 나뉜다. |                                                         |                                                              |                                        |

## 지갑과 어카운트

### 지갑

블록체인 지갑은 블록체인에서 실행되고 개인 및 공개 키를 저장하고 해당 키와 관련된 모든 트랜잭션을 블록 체인에 모니터링하고 유지하는 소프트웨어이다. 즉, 비트코인, 이더리움 등의 암호화폐를 보관할 수 있는 계정을 뜻한다.
**채굴(Mining)**과 **노드(Node)**에서 노드가 바로 **지갑**이다.

#### 지갑의 종류

- 데스크탑(PC) 지갑
- 모바일 지갑
- 하드웨어 지갑
- 웹 지갑

#### 지갑의 구조

지갑은 주소(공개키)와 암호(개인키)로 구성되어 있다. 지갑의 주소(공개키)는 다름 사람들이 암호화폐를 송금할 수 있도록 공개해도 되지만, 개인 암호(개인키)는 오직 지갑 소유자 본인만 알고 있어야 한다.

### 비트코인 - UTXO

UTXO(Unspent Transaction Outputs)는 미사용 트랜잭션 출력값(미지출 거래 출력)을 뜻한다.  
비트코인은 이더리움의 어카운트 모델과 달리 계정이나 잔고가 없고, 블록체인에 기록된 소비되지 않은 출력 값을 통해 거래의 유효성을 검사하여 코인의 존재 여부를 확인한다. 즉, 코인이 지갑에 저장되는 것이 아니라 UTXO에 저장된다고 보면 된다.

#### UTXO의 장단점

- 장점

  **이중 지불 방지** : 트랜잭션을 발생시키면 해당 UTXO는 검증을 받은 후 TX Pool에 들어간다. 그러므로 이중지불이 발생하면 채굴자들은 Pool에서 UTXO 검사 후 사용 기록이 있다면 해당 거래를 무효화 할 수 있다.

  **잔고의 증명** : UTXO는 추적하기가 용이한 장점이 있다. 즉, 거래에 대한 유효성을 검증하기가 매우 쉽다. 일반적으로 이더리움 같은 경우는 트랜잭션들을 모두 검증 및 확인하여 최종적으로 잔고를 유추하지만 UTXO는 해당 사용자의 UTXO만 확인하면 되기 떄문에 그럴 필요가 없다.

- 단점

  UTXO의 가장 큰 단점은 UTXO가 너무 과하게 생성이 될 경우이다. 이더리움은 결과적으로 잔고 하나만 점검하면 끝이지만, UTXO방식을 채용하는 코인들은 흩어져 있는 UTXO를 모두 모아야 되며 소액 결제를 엄청 자주 하거나, 채굴로 이자를 받게 되면 과도한 UTXO로 인해서 불필요한 수수료를 내아할 수 있다.

### 이더리움 - 어카운트(Account)

어카운트(Account)는 이더리움 주소(Address)와 개인키(Private)의 조합이다. 이더리움 계정은 이더 잔고를 보유하고 트랜잭션을 전송할 수 있다.

#### 주소(Address)와 키(Key)

이더리움 블록체인에서 주소와 키는 이더리움의 소유권과 전송을 나타내는데 주로 쓰인다.

- 주소(Address)

  이더리움 블록체인에서 사용자의 신분증에 해당하는 것이 주소이다. 각 주소에는 해당 개인키가 있다. 개인키는 사용자가 알고 있는 일종의 암호로 간주할 수 있으며, 블록체인과 상호 작용하려면 주소 + 개인키 쌍이 필요하다.

  이더리움의 주소와 어카운트의 차이는 은행을 예시로 주소(Address)는 계좌번호를 나타내고 어카운트(Account)는 송금&이체(트랜잭션)를 할 수 있는 계좌라고 이해할 수 있다.

- 키(Key)

  키는 개인키와 공개키로 구분되어 사용된다. 개인키는 무작위로 생성되며 비밀 키로써 유지해야 하는 반면, 공개키는 개인키를 연산하여 생성되며 계정을 식별하는 요소로 사용된다.

#### 이더리움 주소 생성 과정

1. 개인키를 생성하고, 개인키로부터 공개키를 생성한다.
2. Keccak-256 알고리즘으로 공개 키의 해시값을 계산한다.
3. 생성된 해시값의 뒤쪽 20byte만 남기고 제외 후 이더리움 주소를 생성하게 된다.
   - 20byte로 줄여도 누구나 쉽게 계정 주소를 만들 수 있다. 즉 암호화 알고리즘이 이후에 생성된 계정과 중복이 되지않아 검증이 필요하지 않기 때문에 20byte만 남겨도 문제가 안된다.

#### 이더리움의 2가지 유형 계정

- 외부 소유 계정(EOA)

  공개 주소와 개인키의 조합을 말한다. 외부 소유 계정, 또는 외부 계정을 사용하면 다른 계정과 이더를 송수신하고 스마트 컨트랙트에 트랜잭션을 보낼 수 있다.

- 컨트랙트 계정(CA)

  컨트랙트 계정에는 상응하는 개인키가 없다. 이러한 계정은 스마트 계약을 블록체인에 배포할 때 생성된다. 컨트랙트 계정 대신 컨트랙트(Contract)로만 표시되기도 한다.
  컨트랙트(계정)은 다른 계정과 이더를 송수신하고(EOA와 동일), 관련된 코드를 담고(EOA와 다름), EOA나 다른 컨트랙트의 호출을 받아 트랜잭션을 발생시키는 기능을 갖고 있다.

#### 어카운트(Account)의 장단점

- 장점

  **단순성** : 이더리움은 복잡한 스마트 컨트랙트 개발자, 특히 국가 정보가 필요하거나 여러 당사자가 참여하는 개발자의 이익을 위해 보다 직관적인 모델을 선택하였다. 예를 들어 상태를 추적하여 상태를 기반으로 다른 작업을 수행하는 스마트 컨트랙트가 있다. UTXO의 상태 비저장 모델이 트랜잭션에 상태 정보를 포함하도록 강제하므로 계약의 설계가 불필요하게 복잡해지는 것과 대비를 보인다.

  **효율성** : 이더리움의 어카운트는 단순성과 더불어 전송 계정이 거래 비용을 지불하기에 충분한 잔액을 가지고 있는지 확인하기만 하면 되므로 더욱 효율적이다.

- 단점

  **이중 지불** : 이더리움 어카운트의 단점은 이중 지불 공격에 노출된다는 점이다. 이러한 유형의 공격에 대응하기 위해 점증적인 논스(Nonce)를 구현한다. 이더리움에서 모든 계정은 공개적으로 볼 수 있는 논스를 가지고 있고, 거래가 이루어질 때마다 논스는 하나씩 증가한다. 이는 동일한 트랜잭션이 두번 이상 제출되는 것을 방지할 수 있다.

### 비트코인과 이더리움 비교

어느 것이 더 나은 것인지는 사용하려는 목적과 기능, 사용하려는 역할에 따라 달라질 수 있다.

화폐의 역할에 충실해야 한다면 비트코인의 UTXO가 한번 사용되고 사라져 익명성과 보안성이 강하기 때문에 더 훌륭하지만, dApp과 같이 다양한 기능을 구현하고 싶다면 스마트 컨트랙트를 활용할 수 있는 이더리움의 어카운트가 적절하다.

